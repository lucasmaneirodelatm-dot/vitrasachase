<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bus</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>

<h2 id="busTitulo">Bus</h2>

<button id="btnTimbre" class="btn3">ðŸ”” TIMBRE</button>

<div id="estado"></div>

<audio id="audioParada"></audio>

<script>

function log(t){
  document.getElementById("estado").innerHTML += t+"<br>";
}

/* RecepciÃ³n desde sala */
window.addEventListener("message", e=>{
  const { tipo, data } = e.data;

  if (tipo === "INIT_BUS"){
    document.getElementById("busTitulo").textContent =
      "Bus " + data.busId + " â€” " + data.linea;

    log("Subiste al bus.");
  }

  if (tipo === "CONFIRM_TIMBRE"){
    log("âœ” Timbre activado. Se solicitarÃ¡ bajada.");
  }

});

/* TIMBRE */
document.getElementById("btnTimbre").onclick = ()=>{
  parent.postMessage({ tipo:"TIMBRE" }, "*");
  document.addEventListener('DOMContentLoaded', () => {
  const timbreBtn = document.getElementById('timbreBtn');
  if (timbreBtn) {
    timbreBtn.addEventListener('click', () => {
      window.__willRequestStop = true;
      // si necesitas notificar a un iframe que representa el bus:
      const busFrame = document.getElementById('busFrame');
      if (busFrame) busFrame.contentWindow.postMessage({type:'request_stop'}, '*');
    });
  }
});

};

</script>
</body>
</html>
