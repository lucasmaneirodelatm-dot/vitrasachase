<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Parada</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>

<h2 id="paradaTitulo">Parada</h2>

<div id="busList"></div>

<button id="btnCaminar" class="btn2">ğŸš¶ Caminar a otra parada</button>

<script>

/* Recibir eventos de la sala */
window.addEventListener("message", e => {
  const { tipo, data } = e.data;

  if (tipo === "INIT_PARADA"){
    document.getElementById("paradaTitulo").textContent =
      "Parada " + data.id;

    const cont = document.getElementById("busList");
    cont.innerHTML = "";

    data.buses.forEach(b => {
      const div = document.createElement("div");
      div.className = "bus";

      div.innerHTML = `
        <strong>${b.linea}</strong> â€” ${b.eta}
        <button class="btnCoger" data-id="${b.id}" data-linea="${b.linea}">
          ğŸšŒ Coger
        </button>
      `;

      cont.appendChild(div);
    });

    document.querySelectorAll(".btnCoger").forEach(btn=>{
      btn.onclick = ()=>{
        parent.postMessage({
          tipo:"COGER_BUS",
          data:{ busId:btn.dataset.id, linea:btn.dataset.linea }
        },"*");
      };
    });
  }

  if (tipo === "CAMINANDO"){
    document.getElementById("paradaTitulo").textContent =
      "Caminando a la paradaâ€¦";
  }
});

/* CAMINAR A OTRA PARADA */
document.getElementById("btnCaminar").onclick = ()=>{
  const destino = prompt("ID de la parada a la que quieres caminar:");
  if (!destino) return;

  parent.postMessage({
    tipo:"CAMINAR_A",
    data:{ destino }
  },"*");
};

</script>
</body>
</html>
