<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Bus</title>
<link rel="stylesheet" href="../styles.css">
</head>
<body>

<h2>ðŸšŒ Bus 6800-Volvo</h2>

<div id="datos"></div>
<button id="timbre" class="btn">ðŸ”” TIMBRAR</button>

<script>
let busId = null;

// Cuando se carga esta pÃ¡gina, se recibe el bus desde la sala
window.addEventListener("message", ev => {
    if(ev.data.type === "worldUpdate"){
        const buses = ev.data.data.buses;

        if(busId === null){
            // se queda siempre con el primer bus que aparece
            busId = Object.keys(buses)[0];
        }

        const b = buses[busId];
        if(!b) return;

        document.getElementById("datos").innerHTML =
            `LÃ­nea ${b.linea}<br>PrÃ³xima: ${b.next}<br>ETA: ${b.eta}s`;
    }
});

document.getElementById("timbre").onclick = () => {
    if(busId)
        parent.postMessage({ type:"timbreBus", bus: busId }, "*");
};
</script>

</body>
</html>
